# 校园食堂评价系统功能记录

## 项目概述
这是一个基于Spring Boot + MyBatis + Thymeleaf的校园食堂评价系统，提供菜品浏览、评论、用户管理等功能。

## 技术架构
- **后端框架**: Spring Boot 3.x
- **数据库访问**: MyBatis
- **模板引擎**: Thymeleaf
- **数据库**: MySQL
- **前端**: HTML + CSS + JavaScript

## 核心功能模块

### 1. 用户管理模块
**实体类**: `User.java`
**数据访问层**: `UserMapper.java`
**业务逻辑层**: `UserService.java` + `UserServiceImpl.java`
**控制器**: `UserController.java`

**主要功能**:
- 用户注册 (`/api/users/register`)
- 用户登录 (`/api/users/login`)
- 用户退出 (`/api/users/logout`)
- 获取当前用户信息 (`/api/users/current`)
- 查询用户信息 (`/api/users/{id}`)
- 更新用户信息 (`/api/users/{id}`)
- 删除用户 (`/api/users/{id}`)
- 更新个人简介 (`/api/users/{id}/bio`)

**数据库字段**:
- `user_id`: 用户ID（主键）
- `name`: 用户名
- `password`: 密码
- `phone`: 手机号
- `bio`: 个人简介

### 2. 菜品管理模块
**实体类**: `Dish.java`
**数据访问层**: `DishMapper.java`
**业务逻辑层**: `DishService.java` + `DishServiceImpl.java`
**控制器**: `DishController.java`

**主要功能**:
- 获取菜品列表（支持筛选和分页）(`/api/dishes`)
- 获取菜品详情 (`/api/dishes/{id}`)
- 添加菜品 (`/api/dishes`)
- 更新菜品 (`/api/dishes/{id}`)
- 删除菜品 (`/api/dishes/{id}`)
- 获取所有校区 (`/api/dishes/campuses`)
- 获取指定校区的食堂 (`/api/dishes/canteens`)
- 获取指定校区和食堂的档口 (`/api/dishes/stalls`)

**筛选功能**:
- 按校区筛选
- 按食堂筛选
- 按档口筛选
- 按菜品名称搜索
- 多条件组合筛选

**数据库字段**:
- `dish_id`: 菜品ID（主键）
- `campus`: 校区
- `canteen`: 食堂
- `stall`: 档口
- `dish_name`: 菜品名称
- `price`: 价格
- `description`: 菜品描述
- `created_at`: 创建时间

### 3. 评论管理模块
**实体类**: `Comment.java`
**数据访问层**: `CommentMapper.java`
**业务逻辑层**: `CommentService.java` + `CommentServiceImpl.java`
**控制器**: `CommentController.java`

**主要功能**:
- 添加评论 (`/api/comments`)
- 获取菜品评论 (`/api/comments/dish/{dishId}`)
- 获取菜品评论（含用户信息）(`/api/comments/dish/{dishId}/with-user-info`)
- 获取用户评论 (`/api/comments/user/{userId}`)
- 获取用户评论（含菜品信息）(`/api/comments/user/{userId}/with-dish-info`)
- 获取评论详情 (`/api/comments/{commentId}`)
- 删除评论 (`/api/comments/{commentId}`)
- 获取菜品统计信息 (`/api/comments/dish/{dishId}/stats`)
- 检查用户是否已评论 (`/api/comments/dish/{dishId}/user/{userId}/exists`)

**统计功能**:
- 菜品平均评分
- 菜品评论数量
- 评分分布统计（1-5分各有多少个）

**数据库字段**:
- `comment_id`: 评论ID（主键）
- `user_id`: 用户ID（外键）
- `dish_id`: 菜品ID（外键）
- `content`: 评论内容
- `rating`: 评分（1-5分）
- `comment_time`: 评论时间

### 4. 页面路由模块
**控制器**: `PageController.java`

**主要页面**:
- 首页 (`/`)
- 登录页面 (`/login`)
- 注册页面 (`/register`)
- 主页 (`/home`)
- 菜品列表页面 (`/dishes`)
- 菜品详情页面 (`/dish-detail`)
- 我的评论页面 (`/comments`)
- 个人中心页面 (`/profile`)
- 添加评论页面 (`/add-comment`)

**管理员页面**:
- 用户管理 (`/admin/users`)
- 菜品管理 (`/admin/dishes`)
- 评论管理 (`/admin/comments`)
- 统计报表 (`/admin/stats`)

## 数据库设计

### 表关系
- `user` 表：用户信息
- `dish` 表：菜品信息
- `comment` 表：评论信息，关联 `user` 和 `dish` 表

### 外键关系
- `comment.user_id` → `user.user_id`
- `comment.dish_id` → `dish.dish_id`

## API设计规范

### RESTful API
- GET: 查询操作
- POST: 创建操作
- PUT: 更新操作
- DELETE: 删除操作

### 响应格式
```json
{
  "success": true/false,
  "message": "操作结果描述",
  "data": "具体数据"
}
```

### 分页格式
```json
{
  "content": "数据列表",
  "totalPages": "总页数",
  "currentPage": "当前页",
  "totalSize": "总数量",
  "size": "每页大小"
}
```

## 会话管理
- 使用HttpSession管理用户登录状态
- 登录后设置session属性：`userId`, `username`, `user`
- 退出时清除session

## 安全考虑
- 密码存储：建议使用加密存储
- 会话管理：登录状态验证
- 输入验证：参数校验和SQL注入防护

## 扩展功能建议
1. 图片上传功能
2. 评分可视化展示
3. 推荐算法
4. 移动端适配
5. 消息通知系统
6. 数据导出功能 